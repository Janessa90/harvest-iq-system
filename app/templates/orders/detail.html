{% extends 'base.html' %}
{% block title %}Order Details{% endblock %}

{% block content %}
<div class="container py-4">

  <h2 class="fw-bold mb-4">
    ðŸ“¦ Order #{{ order.id }}
  </h2>

  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body">

      <!-- STATUS -->
      <div class="mb-3">
        <span class="badge
          {% if order.status == 'pending' %} bg-warning text-dark
          {% elif order.status == 'to_ship' %} bg-info
          {% elif order.status == 'to_receive' %} bg-primary
          {% elif order.status == 'completed' %} bg-success
          {% else %} bg-danger
          {% endif %}
        ">
          {{ order.status.replace('_',' ').title() }}
        </span>
      </div>

      <!-- ADDRESS -->
      <p>
        <strong>Shipping Address:</strong><br>
        {{ order.shipping_address }}
      </p>

      <!-- PAYMENT -->
      <p>
        <strong>Payment Method:</strong>
        {{ order.payment_method.upper() }}
      </p>

      <hr>

      <!-- ITEMS -->
      <h5 class="fw-bold mb-3">Items</h5>

      {% set computed_total = namespace(value=0) %}

      {% for item in order.items %}

      {% set subtotal = item.unit_price * item.quantity %}
      {% set computed_total.value =
            computed_total.value + subtotal %}

      <div class="d-flex justify-content-between align-items-center border-bottom py-2">

        <div>
          <strong>
            {{ item.product.name if item.product else "Deleted Product" }}
          </strong><br>

          <small class="text-muted">
            â‚±{{ "%.2f"|format(item.unit_price) }}
            Ã— {{ item.quantity }}
          </small>
        </div>

        <div class="fw-bold text-success">
          â‚±{{ "%.2f"|format(subtotal) }}
        </div>

      </div>

      {% endfor %}

      <hr>

      <!-- TOTAL -->
      <div class="d-flex justify-content-between">
        <strong>Total Amount:</strong>
        <strong class="text-success fs-5">
          â‚±{{ "%.2f"|format(order.total_amount or computed_total.value) }}
        </strong>
      </div>

    </div>
  </div>

</div>
{% endblock %}