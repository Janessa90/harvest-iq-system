{% extends 'base.html' %}
{% block title %}My Orders{% endblock %}

{% block content %}
<div class="container py-4">

  <h2 class="fw-bold mb-4"> My Orders</h2>

  <!-- STATUS FILTER NAV -->
  <div class="d-flex gap-3 mb-4 flex-wrap">

    <a href="{{ url_for('orders.my_orders') }}"
       class="btn btn-sm {{ 'btn-dark' if not current_status else 'btn-outline-secondary' }}">
       All
    </a>

    <a href="{{ url_for('orders.my_orders', status='pending') }}"
       class="btn btn-sm {{ 'btn-warning' if current_status == 'pending' else 'btn-outline-warning' }}">
       Pending
       {% if counts.pending > 0 %}
         <span class="badge bg-danger ms-1">{{ counts.pending }}</span>
       {% endif %}
    </a>

    <a href="{{ url_for('orders.my_orders', status='to_ship') }}"
       class="btn btn-sm {{ 'btn-info' if current_status == 'to_ship' else 'btn-outline-info' }}">
       To Ship
       {% if counts.to_ship > 0 %}
         <span class="badge bg-danger ms-1">{{ counts.to_ship }}</span>
       {% endif %}
    </a>

    <a href="{{ url_for('orders.my_orders', status='to_receive') }}"
       class="btn btn-sm {{ 'btn-primary' if current_status == 'to_receive' else 'btn-outline-primary' }}">
       To Receive
       {% if counts.to_receive > 0 %}
         <span class="badge bg-danger ms-1">{{ counts.to_receive }}</span>
       {% endif %}
    </a>

    <a href="{{ url_for('orders.my_orders', status='completed') }}"
       class="btn btn-sm {{ 'btn-success' if current_status == 'completed' else 'btn-outline-success' }}">
       Completed
       {% if counts.completed > 0 %}
         <span class="badge bg-danger ms-1">{{ counts.completed }}</span>
       {% endif %}
    </a>

  </div>

  {% if orders.items %}
  
    {% for order in orders.items %}
    <div class="card shadow-sm border-0 mb-3">
      <div class="card-body d-flex justify-content-between align-items-center flex-wrap">

        <div>
          <div class="fw-bold">
            Order #{{ order.id }}
          </div>

          <div class="text-muted small">
            {{ order.created_at.strftime("%b %d, %Y") }}
          </div>

          <div class="mt-2">
            <span class="badge
              {% if order.status == 'pending' %} bg-warning text-dark
              {% elif order.status == 'to_ship' %} bg-info
              {% elif order.status == 'to_receive' %} bg-primary
              {% elif order.status == 'completed' %} bg-success
              {% else %} bg-danger
              {% endif %}
            ">
              {{ order.status.replace('_',' ').title() }}
            </span>
          </div>
        </div>

        <div class="text-end">
          <div class="fw-bold text-success mb-2">
            â‚±{{ "%.2f"|format(order.total_amount) }}
          </div>

          <a href="{{ url_for('orders.order_detail', order_id=order.id) }}"
             class="btn btn-outline-primary btn-sm">
             View Details
          </a>

          {% if order.status == 'pending' %}
          <form action="{{ url_for('orders.cancel_order', order_id=order.id) }}"
                method="POST"
                class="d-inline">
            <button class="btn btn-outline-danger btn-sm">
              Cancel
            </button>
          </form>
          {% endif %}

        </div>

      </div>
    </div>
    {% endfor %}

  {% else %}
    <div class="text-center py-5">
      <h5>No orders found.</h5>
      <a href="{{ url_for('products.list_products') }}"
         class="btn btn-success mt-3">
         Start Shopping
      </a>
    </div>
  {% endif %}

</div>
{% endblock %}