{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="container py-4">

  <h2 class="fw-bold mb-2">ðŸ›  Admin Dashboard</h2>
  <p class="text-muted mb-4">Approve farmer weighed products</p>

  <div class="card shadow-sm border-0">
    <div class="card-header fw-bold">
      Pending Weigh Logs
    </div>

    <div class="card-body p-0">

      {% if logs %}
      <div class="table-responsive">
      <table class="table mb-0 table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>Farmer</th>
            <th>Location</th>
            <th>Product</th>
            <th>Weight</th>
            <th>Price/kg</th>
            <th>Total Value</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody>
          {% for log in logs %}
          <tr>

            <!-- FARMER -->
            <td>
              <div class="fw-semibold">
                {{ log.farmer.full_name or log.farmer.username }}
              </div>
              <small class="text-muted">
                ID: {{ log.farmer.id }}
              </small>
            </td>

            <!-- LOCATION -->
            <td>
              {{ log.farmer.city }},
              {{ log.farmer.province }}
            </td>

            <!-- PRODUCT -->
            <td>
              {{ log.product_name }}
            </td>

            <!-- WEIGHT -->
            <td class="fw-bold text-success">
              {{ log.weight_kg }} kg
            </td>

            <!-- PRICE INPUT -->
            <td>
              <form action="{{ url_for('admin.approve_log', log_id=log.id) }}"
                    method="POST"
                    class="d-flex gap-2">

                <input type="number"
                       name="price"
                       step="0.01"
                       value="{{ log.farmer.price_per_kg }}"
                       required
                       class="form-control form-control-sm"
                       style="width:120px;">
            </td>

            <!-- AUTO TOTAL PREVIEW -->
            <td>
              â‚±{{ "%.2f"|format(log.weight_kg * (log.farmer.price_per_kg or 0)) }}
            </td>

            <!-- APPROVE BUTTON -->
            <td>
                <button type="submit"
                        class="btn btn-sm btn-success">
                  Approve
                </button>
              </form>
            </td>

          </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>

      {% else %}
      <div class="text-center py-4 text-muted">
        No pending weigh logs.
      </div>
      {% endif %}

    </div>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
setInterval(function(){
    location.reload();
}, 5000);
</script>
{% endblock %}