{% extends 'base.html' %}
{% block title %}Aking Dashboard{% endblock %}

{% block content %}
<div class="container py-4">

  <h2 class="fw-bold mb-1">ğŸ‘¤ Aking Dashboard</h2>
  <p class="text-muted mb-4">
    Maligayang pagbabalik,
    {{ current_user.full_name or current_user.username }}!
  </p>

  <!-- AI SEARCH BAR -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body">

      <h5 class="fw-bold mb-3">ğŸ¤– AI Paghahanap ng Produkto</h5>

      <form action="{{ url_for('search.search') }}" method="GET">
        <div class="input-group">

          <input
            type="text"
            name="q"
            class="form-control"
            placeholder="Maghanap hal. kamatis, patatas, sibuyas..."
            required
          >

          <button class="btn btn-success">
            ğŸ” Maghanap
          </button>

        </div>
      </form>

    </div>
  </div>

  <!-- Quick Stats -->
  <div class="row g-3 mb-4">

    <div class="col-6 col-md-3">
      <div class="card border-0 shadow-sm text-center p-3">
        <div class="stat-icon">ğŸ“¦</div>
        <div class="fs-3 fw-bold">{{ orders|length }}</div>
        <div class="text-muted small">Kabuuang Order</div>
      </div>
    </div>

    <div class="col-6 col-md-3">
      <div class="card border-0 shadow-sm text-center p-3">
        <div class="stat-icon text-success">âœ…</div>
        <div class="fs-3 fw-bold">
          {{ orders|selectattr('status','eq','delivered')|list|length }}
        </div>
        <div class="text-muted small">Na-deliver</div>
      </div>
    </div>

    <div class="col-6 col-md-3">
      <div class="card border-0 shadow-sm text-center p-3">
        <div class="stat-icon text-warning">â³</div>
        <div class="fs-3 fw-bold">
          {{ orders|selectattr('status','in',
          ['pending','confirmed','processing','shipped'])|list|length }}
        </div>
        <div class="text-muted small">Pinoproseso</div>
      </div>
    </div>

    <div class="col-6 col-md-3">
      <div class="card border-0 shadow-sm text-center p-3">
        <div class="stat-icon text-success">ğŸ’°</div>
        <div class="fs-3 fw-bold">
          â‚±{{ "%.0f"|format(orders|sum(attribute='total_amount')) }}
        </div>
        <div class="text-muted small">Kabuuang Nagastos</div>
      </div>
    </div>

  </div>

  <!-- Quick Actions -->
  <div class="row g-3 mb-4">

    <div class="col-md-4">
      <a href="{{ url_for('products.list_products') }}"
         class="card border-0 shadow-sm text-decoration-none text-dark quick-action-card">
        <div class="card-body d-flex align-items-center gap-3 py-3">
          <div class="quick-icon">ğŸ›’</div>
          <div>
            <div class="fw-semibold">Mamili ng Produkto</div>
            <div class="text-muted small">
              Sariwang ani mula sa bukid
            </div>
          </div>
        </div>
      </a>
    </div>

    <div class="col-md-4">
      <a href="{{ url_for('orders.my_orders') }}"
         class="card border-0 shadow-sm text-decoration-none text-dark quick-action-card">
        <div class="card-body d-flex align-items-center gap-3 py-3">
          <div class="quick-icon">ğŸ“‹</div>
          <div>
            <div class="fw-semibold">Aking Mga Order</div>
            <div class="text-muted small">
              Subaybayan ang delivery
            </div>
          </div>
        </div>
      </a>
    </div>

    <div class="col-md-4">
      <a href="{{ url_for('users.profile') }}"
         class="card border-0 shadow-sm text-decoration-none text-dark quick-action-card">
        <div class="card-body d-flex align-items-center gap-3 py-3">
          <div class="quick-icon">ğŸ‘¤</div>
          <div>
            <div class="fw-semibold">Aking Profile</div>
            <div class="text-muted small">
              I-edit ang impormasyon
            </div>
          </div>
        </div>
      </a>
    </div>

  </div>

  <!-- Recent Orders -->
  <div class="card border-0 shadow-sm" style="border-radius:14px">

    <div class="card-header bg-transparent fw-bold border-0 pt-3
                d-flex justify-content-between align-items-center">
      Mga Huling Order
      <a href="{{ url_for('orders.my_orders') }}"
         class="btn btn-outline-success btn-sm">
         Tingnan Lahat
      </a>
    </div>

    <div class="card-body p-0">

      {% if orders %}
      <div class="table-responsive">

        <table class="table table-hover mb-0">

          <thead class="table-light">
            <tr>
              <th>Order</th>
              <th>Item</th>
              <th>Kabuuan</th>
              <th>Status</th>
              <th>Petsa</th>
              <th></th>
            </tr>
          </thead>

          <tbody>
          {% for order in orders %}
            <tr>

              <td class="fw-semibold text-success">
                #{{ order.id }}
              </td>

              <td class="text-muted small">
                {{ order.item_count }} item(s)
              </td>

              <td class="fw-semibold">
                â‚±{{ "%.2f"|format(order.total_amount) }}
              </td>

              <td>
                <span class="badge
                  {% if order.status == 'delivered' %}bg-success
                  {% elif order.status == 'cancelled' %}bg-danger
                  {% elif order.status == 'pending' %}bg-warning text-dark
                  {% else %}bg-info text-dark{% endif %}">
                  {{ order.status | title }}
                </span>
              </td>

              <td class="text-muted small">
                {{ order.created_at.strftime('%b %d, %Y') }}
              </td>

              <td>
                <a href="{{ url_for('orders.order_detail',
                                    order_id=order.id) }}"
                   class="btn btn-sm btn-outline-success">
                   Tingnan
                </a>
              </td>

            </tr>
          {% endfor %}
          </tbody>

        </table>

      </div>

      {% else %}

      <div class="text-center py-4 text-muted">
        Wala pang order.
        <a href="{{ url_for('products.list_products') }}"
           class="text-success">
           Mamili na!
        </a>
      </div>

      {% endif %}
    </div>
  </div>

</div>
{% endblock %}